{% extends 'base.html' %}
{% block content %}
<div class="container text-center py-4">

<img src="{% url 'generate_qr' order.id %}" class="qr img-fluid" id="qr_code" alt="QR code">
<div class="mt-2">{{ orderCompany }} : {{ orderName }}</div>

<button class= "btn btn-success mt-3" id="download_pdf">Zapisz PDF (3x8)</button>
<button class= "btn btn-secondary mt-3" onclick="location.href='{% url 'order_detail' order.url %}'">Wróć</button>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
<script>
    //decodes txt html issues
    function htmlDecode(input) {
        var doc = new DOMParser().parseFromString(input, "text/html");
        return doc.documentElement.textContent;
      }

    document.getElementById("download_pdf").addEventListener("click", function () {
        var orderName = "{{ orderName }}";
        var orderCompany = "{{ orderCompany }}";
        var doc = new jsPDF('p', 'pt', 'letter');
        doc.setFontSize(6);
        var qrImages = document.querySelectorAll(".qr");
        var qrImageCount = qrImages.length;
        var x = 15, y = 15;
        for (var i = 0; i < qrImageCount * 24; i++) {
            if (i % 3 == 0 && i != 0) {
                y += 95;
                x = 10;
            }
            var imgData = qrImages[i % qrImageCount];
            doc.addImage(imgData, 'PNG', x, y, 170, 70);
            x += 200;
            
            doc.text(x - 150, y + 80,  htmlDecode(orderCompany) + " : " +  htmlDecode(orderName));
        }
        doc.save('qr_codes.pdf');
    });
</script>

{% endblock %}
